{% load static %}
{% load ibuilder %}
{% load thumbnail %}
<!DOCTYPE html>
<html>
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-180528762-1"></script>
    <script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-180528762-1');</script>  
    <title>
    {% block title %}Messages{% endblock %}
    </title> 
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/d3a3fc2f19.js" crossorigin="anonymous"></script>
    <script src="{% static 'notifications/notify.js' %}" type="text/javascript"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
    <link
      href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
      rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.css">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'EasyAutoComplete/easy-autocomplete.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/post/style.css' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon_folder/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon_folder/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon_folder/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'favicon_folder/site.webmanifest' %}">
    <link rel="mask-icon" href="{% static 'favicon_folder/safari-pinned-tab.svg' %}" color="#90c4f5">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
</head>
<body class="d-flex flex-column h-100" style="background-color: white !important;">
    <div id="#navPlaceholder" class="fixed-top mb-4">{% include 'home/nav.html' %}</div>
    <div class="wrapper" style="margin-top: 5rem;">
        <div class="container w-100 d-flex justify-content-center" style="overflow-y: hidden;">
            <div style=" width: 92%;">
                <div class="row " style="min-height: 90vh !important;">
                    <div class="col-md-auto"></div>
                    <div class="border-top border-left border-bottom rounded col-md-4 p-0 border-right" 
                        style="border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;overflow-y: auto !important;">
                        <div class="border-bottom p-2 user-search-box w-100">
                            <div class="d-flex align-item-center justify-content-between" style="margin-bottom: 4px;">
                                <div class="d-flex align-items-center font-weight-bold h5" style="margin-top: 16px !important;">
                                    Messages
                                </div>
                                <div class="d-flex align-items-center">
                                    <button style="margin-top: 13px !important;" class="nav-link btn-sm border btn-default btn-circle no-border rounded-circle text-dark" data-tooltip="tooltip"
                                    data-placement="bottom" title="Add" data-delay='{ "show": 500, "hide": 100 }'>
                                    <svg width="16" height="16" viewBox="0 0 16 16"  class="bi bi-plus " fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                      <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                    </svg></button>
                                </div>
                            </div>
                            <div id="search-users">
    
                            </div>              
                        </div> 
                        <div style="padding-right: 0px !important; padding-left: 0px !important;">
                            <div id="current-chats p-0">
                                <ul class="list-group list-group-flush" id="user-chat-list" style="overflow-y: auto !important; height: 82.5vh!important;">
                                    {% for user in users %}
                                        <a class="text-dark chat__message__link mb-1" href="{% url 'chat:get-or-create-private-chat' id=user.get_hashid %}" style="text-decoration: none;">
                                            <li class="user-message-contact  d-flex align-items-center list-group-item" id="{{ user.get_hashid }}__chat">
                                                <div class="d-flex align-items-center w-100">
                                                    <div class="mr-3 user-image">
                                                        {% thumbnail user.image "55x55" crop="80% top" as im %}
                                                            <img class="rounded-circle" style="margin:{{ im|margin:'55x55' }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}">
                                                        {% endthumbnail %}
                                                    </div>
                                                    <div class="user-chat-info w-100">
                                                        <div class="text-dark d-flex justify-content-between user-name-container" style="font-weight: 500;" style="margin-top: 10px;">
                                                            <div style="font-size: 0.95rem;">{{ user.get_full_name }}</div>
                                                        </div>
                                                        <span style="font-size: 0.95rem;" class=" text-muted last-message-holder" style="margin-top: -10px !important;" id="{{ user.get_hashid }}__chat__last_msg">
                                                            {% with last_message_content|get_dict_item:user.username as dict %}
                                                            <span class="message" >
                                                                {{  dict|get_dict_item:"content" }}                                                           
                                                            </span>                                            
                                                            <span class="mx-1 button__separator_time">
                                                            {% if dict|get_dict_item:"content" != '' %}Â·{% endif %}
                                                            </span>                                                 
                                                            <span style="font-size: 0.95rem;" id="{{ user.get_hashid }}__chat__last_msg__time" class="time">
                                                               {{ dict|get_dict_item:"time" }}
                                                            </span>
                                                            {% endwith %}
                                                        </span>                                                       
                                                    </div>
                                                </div>
                                            </li>
                                        </a>                                 
                                    {% endfor %}    
                                  </ul>                        
                            </div>                    
                        </div>
                    </div>
                    <div class="col-md-7 p-0 border-right border-top border-bottom rounded"  style="border-top-left-radius:0px !important;border-bottom-left-radius:0px !important;overflow-y: auto !important;">
                        {% block chat %}
                        <div class="d-flex justify-content-center align-items-center h-100">
                            <div class="my-auto">
                                <div class="p-2 text-center">
                                    <div class="mb-4">
                                        <i class='fas fa-comments' style="font-size: 102px !important;"></i>
                                    </div>
                                    <h3>Messages</h3>
                                    <p class="lead small text-muted" style="font-weight: 450;">
                                        Send private message to your friends.
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endblock %}
                    </div>
                </div>   
            </div>     
        </div>
    </div>
    <script src="{% static 'linkifyjs/linkify.min.js' %}"></script>
    <script src="{% static 'linkifyjs/linkify-jquery.min.js' %}"></script>
    <style>
    
        #chat-log {      
            height: 75vh;
            overflow-y: scroll;
            overflow-x: hidden;
            padding-bottom: 15px;
            font-size: 0.96rem;
        }

        #chat-log .message-holder:nth-last-child(1) {
            margin-bottom: 20px !important;
        }
        .last-message-holder .message {   
            white-space: nowrap !important;
            display:inline-block;
            max-width: 180px !important;             
            overflow: hidden !important;              
            -o-text-overflow: ellipsis !important;    
            text-overflow:    ellipsis !important; 
            float:  left !important;   
        }
        .msg_time__container_text.hidden__time_stamp {
            display: none;
        }
        .min-msg-p {
            min-width: 30px !important;
        }
        .dropup {
            display: inline-block;
        }
        .dropdown-menu.edit-message-dropdown {
            width: auto !important;
            height: auto !important;
            min-width: inherit;
        }
        .dropdown-menu.edit-message-dropdown a {
            padding: 5px;
            width: auto;
        }

        [class*="dropdown-menu-tip-"]::after {
            content: '';
            position: absolute;
            width: .5rem;
            height: .5rem;
            background-color: white; /* For SCSS use $dropdown-bg */
            border: solid 1px rgba(0, 0, 0, .15); /* For SCSS use $dropdown-bg */
            border-bottom: none;
            border-left: none;
        }

        .user-message-contact:hover {
            background-color: rgba(240, 240, 240, 0.521);
        }

        .user-message-contact.chat-active {
            background-color: rgba(240, 240, 240, 0.521);
        }

        .dropdown-menu-tip-n::after {
            top: calc(-.25rem - 1px);
            left: calc(50% - .25rem);
            transform: rotate(-45deg);
        }

        .dropdown-menu-tip-ne::after {
            top: calc(-.25rem - 1px);
            right: 1rem;
            transform: rotate(-45deg);
        }

        .dropdown-menu-tip-nw::after {
            top: calc(-.25rem - 1px);
            left: 1rem;
            transform: rotate(-45deg);
        }

        .dropdown-menu-tip-s::after {
            left: calc(50% - .25rem);
            bottom: calc(-.25rem - 1px);
            transform: rotate(135deg);
        }

        .dropdown-menu-tip-se::after {
            right: 1rem;
            bottom: calc(-.25rem - 1px);
            transform: rotate(135deg);
        }

        .dropdown-menu-tip-sw::after {
            left: 1rem;
            bottom: calc(-.25rem - 1px);
            transform: rotate(135deg);
        }

        .message-holder .self__message .chat-message-menu{
            display: none;
        }
        .message-holder .self__message:hover .chat-message-menu{
            display: block;
        }

        #replyContainer__messages {
            margin-left: -8px;
            margin-right: -8px;
            padding-bottom: 5px;
            margin-bottom: 6px !important;
        }

        #replyContainer__messages .reply__message__content {
            white-space: nowrap !important;
            display:inline-block;
            max-width: 90vw !important;             
            overflow: hidden !important;              
            -o-text-overflow: ellipsis !important;    
            text-overflow:    ellipsis !important; 
            float:  left !important;   
            margin-bottom: 10px;
        }

        .reply__message__container .message-reply-box {
            padding: 5px;
        }

        .reply__message__container {
            padding-left: 20px;
            padding-right: 20px;
        }

        .reply__message__container .sent-replied .reply-message-content{
            padding: 7px;
            background-color: rgba(226, 226, 226, 0.464);
            border-radius: 25px;
        }

        .reply__message__container .replied-replied .reply-message-content{
            padding: 7px;
            background-color: white;
            border: 1px rgb(226, 226, 226) solid;
            border-radius: 25px;
        }

        .reply__message__container.border-right-reply .message-reply-box{
            border-right: 3px solid rgb(212, 212, 212);
        }

        .reply__message__container.border-left-reply .message-reply-box{
            border-left: 3px solid rgb(212, 212, 212);
        }
        .msg-image-container {
            background-color: rgba(255, 255, 255, 0) !important;
            padding-right: 0px;
        }
     </style>

</body>
</html>