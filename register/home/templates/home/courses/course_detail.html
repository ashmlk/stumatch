{% extends 'home/courses/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load ibuilder %}
{% block title %}
<title>{{ course.course_code }}  </title>
{% endblock %}
{% block content %}
{% bg_rand as bgrnd %}
<div class="mt-2" style="padding-top: 0.18645343rem;">
    <div class="bg-white border"
        style="overflow:hidden !important;border-top-left-radius: 8px !important;border-top-right-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">
        <div class="c_code align-items-center bg-primary-main">
            <div class="d-flex justify-content-between px-3 pb-4 pt-3 ml-1">
                <div>
                    <h5 class="mt-2 text-white display-4" style="font-weight:500; font-size: 1.9rem;">
                        {{ course.course_code }}
                        <div class="d-flex pt-1">
                            <a class="c_dis mb-1 text-center crs-btn p-0 small text-white" href="{% url 'home:course-mutual-students' %}?id={{ course.get_hashid }}&o=ins">
                                <span class="small" >
                                    <span class="ccs mr-1">
                                        <i class="fas fa-user-graduate"></i>
                                    </span>{{ course.get_user_count }} {% if course.get_user_count == 1 %}<span>student</span>{% else %}
                                    <span>students</span>{% endif %}<span>{% if not link_get %}, {{ course.get_user_count_ins }} with {{ course.course_instructor_fn|capfirst }} {{ course.course_instructor|capfirst }}{% endif %}
                                    </span>
                                </span>
                            </a>
                        </div>
                    </h5>
                </div>
            </div>
        </div>
        <div class="px-3 mb-2">
            <div class="pt-2" style="min-height: 100px !important;">
                <div class="row d-flex align-items-center justify-content-start mb-2">
                    <div class="mr-1">
                        <a style="border-radius: 20px !important;"
                            class="text-left c_dis mb-1 course-goto btn btn-outline-primary border-0"
                            href="{% url 'home:university-detail' %}?u={{ course.course_university}}&obj=std">
                            <span class="svg-icon ccs">
                                <i class="fas fa-university"></i>
                            </span>
                            <span class="ml-1 text-dark btn-text-dark ">
                                {{ course.course_university|capfirst }}
                            </span>
                        </a>
                    </div>
                    {% if not link_get %}
                    <div class="mr-1">
                        <a style="border-radius: 20px !important; "
                            class="text-left c_dis mb-1 course-goto btn btn-outline-primary border-0 "
                            href="{%url 'home:course-instructor' course.course_university_slug course.course_instructor_slug %}">
                            <span class="svg-icon ccs">
                                <svg width="1em" height="1em" viewBox="0 0 16 16"
                                    class="bi bi-layers" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M3.188 8L.264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l-1.063.567L14.438 10 8 13.433 1.562 10 4.25 8.567 3.187 8z" />
                                    <path fill-rule="evenodd"
                                        d="M7.765 1.559a.5.5 0 0 1 .47 0l7.5 4a.5.5 0 0 1 0 .882l-7.5 4a.5.5 0 0 1-.47 0l-7.5-4a.5.5 0 0 1 0-.882l7.5-4zM1.563 6L8 9.433 14.438 6 8 2.567 1.562 6z" />
                                </svg>
                            </span>
                            <span class="ml-1 text-dark btn-text-dark">{{ course.course_instructor_fn|capfirst }}
                                {{ course.course_instructor|capfirst }}</span>
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% if not link_get %}
                <div style="margin-left: -3px;">
                    <div class="d-flex align-items-center justify-content-start rating-ctr">
                        <div>
                            <span class="svg-icon ccs mr-1 d-flex justify-content-center align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg"  width="16" height="16" fill="currentColor" class="bi bi-star text-primary" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                  </svg>
                            </span>
                        </div>
                        <div class="ml-1">
                            {% if course.complexity_btn == "None" %}
                            <div class="c_dis  text-muted border-0">
                                <span>Overall:</span><span > No ratings</span>
                            </div>
                            {% else %}
                            <div  class="c_dis text-{{ course.complexity_btn }}">
                                <span>Overall:</span><span> {{ course.average_complexity }}</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="mx-1">
                            Â·
                        </div>
                        <div>
                            {% if course.complexity_btn_ins == "None" %}
                            <div class="c_dis text-muted" >
                                <span>Instructor:</span><span > No ratings</span>
                            </div>
                            {% else %}
                            <div  class="c_dis text-{{ course.complexity_btn_ins }}">
                                <span>Instructor: </span>
                                <span >
                                    {{ course.average_complexity_ins }}
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="=d-flex flex-column rating-ctr">
                    <div class="d-flex justify-content-start align-items-center mr-1" style="margin-left: -3px;">
                        <div>
                            <span class="svg-icon ccs d-flex justify-content-center align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star text-primary" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                  </svg>
                            </span>
                        </div>
                        <div class="ml-1">
                            {% if course.complexity_btn == "None" %}
                            <div class="c_dis  text-muted border-0">
                                <span>Overall:</span><span > No ratings</span>
                            </div>
                            {% else %}
                            <div class="c_dis text-{{ course.complexity_btn }}">
                                <span>Overall:</span><span> {{ course.average_complexity }}</span>
                            </div>
                            {% endif %}
                        </div>                  
                    </div>
                </div>
                {% endif %}
                <div>
                    {% if link_get  %}
                    <div class="c_dis mb-1">
                        <span class="small text-muted">You have <span class="text-danger">not </span> taken this
                            course.</span>
                        <button class="btn-sm mb-1 btncrsatadd rounded btn  small " type="button"
                            style="text-decoration: none;border: 1px solid rgba(0, 0, 0, .15) !important;"
                            {% if not link_get %}
                            data-url="{% url 'home:course-auto-add' course_code=course.course_code course_instructor_slug=course.course_instructor_slug course_university_slug=course.course_university_slug %}"
                            {% else %}
                            data-url="{% url 'home:course-auto-add' course_code=course.course_code course_instructor_slug='ALL' course_university_slug=course.course_university_slug %}"
                            {% endif %}
                            >
                            Add
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="border-top d-flex w-100 justify-content-between pr-1">
                <div class="votes-container">
                    {% include 'home/courses/course_vote.html' with course=course %}
                </div>
                <div>
                    <form method="POST" class="course-save-form">
                        {% csrf_token %}
                        <button class="save-course border-0 btn p-0" type="submit"
                            data-url="{% url 'home:course-save' course.get_hashid %}">
                            <span class="small">
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-bookmark-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M4.5 2a.5.5 0 0 0-.5.5v11.066l4-2.667 4 2.667V8.5a.5.5 0 0 1 1 0v6.934l-5-3.333-5 3.333V2.5A1.5 1.5 0 0 1 4.5 1h4a.5.5 0 0 1 0 1h-4zm9-1a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1H13V1.5a.5.5 0 0 1 .5-.5z"/>
                                    <path fill-rule="evenodd" d="M13 3.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0v-2z"/>
                                  </svg>
                            </span>
                            <span class="small">
                                Save
                            </span>
                        </button>
                    </form>
                </div>
            </div>
            
        </div>
    </div>
    <div class="row mt-1" style="padding-right: 10px; padding-left: 10px;">
        <div class="col-sm-4 col-4 px-1">
            <button class="v_rebtn col-sm-12 mb-1 btn  small border rounded bg-white" data-text="Show"
                style="text-decoration: none; border: 1px solid rgba(0, 0, 0, .15) !important;"
                type="button">Review</button>
        </div>
        <div class="col-sm-4 col-4 px-1">
            <!-- removed acaffd class -->
            <a class="col-sm-12 mb-1 rounded btn small  acaffd c bg-white"
                style="text-decoration: none;border: 1px solid rgba(0, 0, 0, .15) !important;"
                href="{% url 'home:course-mutual-students' %}?id={{ course.get_hashid }}&o=ins">Students</a>
        </div>
        <div class="col-sm-4 col-4 px-1">
            <!-- removed acaffd class -->
            <div class="dropdown">
                <button class="col-sm-12 rounded btn small  get-instructors-btn bg-white" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                    style="text-decoration: none;border: 1px solid rgba(0, 0, 0, .15) !important;"
                    data-url="{% url  'home:get-course-instructors-data' course.course_code course.course_university_slug %}"
                >
                    Instructors
                </button>
                <div class="dropdown-menu bg-white mt-1" aria-labelledby="dropdownMenuLink" id="instructor-list-dropdown" 
                    style="font-size: 0.92rem !important;text-transform:capitalize;max-height: 263px;overflow-y: scroll; width: auto !important;">
                    <a class="dropdown-item" href="{% url 'home:course-instructors' course.course_university_slug course.course_code %}">
                        All
                    </a>
                    <div class="dropdown-divider"></div>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="p-0 mb-4">
    <div class="w-100 review-textbox pb-1 pt-1 my-2" id="crwfrmcntr" style="display: none;">
        {% if not link_get %}
            {% if not cannot_review %}
                <form class="w-100 course-review-form"
                    data-url="{% url 'home:course-detail' course.course_university_slug course.course_instructor_slug course.course_code %}"
                    method="POST">
                    {% csrf_token %}
                    <div class="d-flex  flex-column">
                        <div class="bg-white d-flex border rounded p-1">
                            <div class="mr-1">
                                <img class="img-create-post rounded-circle" style="height: 2.5rem;width: 2.5rem;"
                                    src="{{ request.user.image.url }}">
                            </div>
                            <div>
                                {{ form|crispy }}
                            </div>
                        </div>
                        <div class="d-flex justify-content-end my-1">
                            <div>
                                <button class="border-0 no-border btn btn-sm small btn-primary rw-submit-btn"
                                    style="border-radius:20px;text-decoration: none;" type="submit" data-value="anon">Submit
                                    Anonymously</button>
                                <button class="border-0 no-border btn btn-sm small btn-primary rw-submit-btn"
                                    style="border-radius:20px;text-decoration: none;" type="submit"
                                    data-value="pub">Submit</button>
                            </div>
                        </div>
                    </div>
                </form>
            {% else %}
            <div class="w-100 card">
                <div class="card-body">
                    <p class="card-text text-center text-dark">
                        You have already written a review for <span class="text-muted">{{ course.course_code }}</span>
                        with <span class="text-muted">{{ course.course_instructor_fn|capfirst }}
                            {{ course.course_instructor|capfirst }}</span>.
                    </p>
                    <div class="d-flex justify-content-center">
                        <div>
                            <a class="w-100 text-center"
                                href="{% url 'home:user-course-reviews' %}?course_university={{ course.course_university_slug }}&course_instructor={{ course.course_instructor_slug }}&course_code={{ course.course_code }}">
                                <span class="small">
                                    See Your Reviews
                                </span>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
            {% endif %}
        {% else %}
        <div class="w-100 card">
            <div class="card-body">
                <p class="card-text text-center text-dark">
                    Please select an instructor before writing a review
                </p>
            </div>
        </div>
        {% endif %}
    </div>
    <div id="reviews" class="mt-1" style="margin-left: -1px !important;">
        <div class="mt-3 mb-3">
            <div class="row px-3 d-flex justify-content-center" style="font-size: 0.92rem;">
                <div class="col-6 p-0">
                    <div class="card border-0 border-bottom bg-transparent">
                        <a class="text-center jc-nav-link  text-muted{% if link_get %}-active{% endif %} text-dark"
                                href="{% url 'home:course-detail' course.course_university_slug 'ALL' course.course_code %}?rw=all">
                                All Reviews for {{ course.course_code }}
                                (<span id="crsrwalcts">{{ reviews_all_count }}</span>)
                        </a>
                    </div>
                </div>
                {% if not link_get %}
                <div class="col-6 p-0">
                    <div class="card border-0 border-bottom  bg-transparent">
                         <a class="text-center jc-nav-link text-muted{% if not link_get %}-active{% endif %} text-dark" 
                            href="{% url 'home:course-detail' course.course_university_slug course.course_instructor_slug course.course_code %}">Reviews
                            with {{ course.course_instructor_fn|capfirst }}
                            {{ course.course_instructor|capfirst }}
                            (<span id="crsspecrw">{{ reviews_count }}</span>)
                         </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="tab-content">
            <div class="c-review-list ">
                {% if link_get %}
                    <div class="dropdown">
                        <button class="btn mb-1 btn-light border btn-sm border dropdown-toggle" type="button" id="d_li" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            {{ sortby|capfirst }}
                        </button>
                        <div class="srbtnmenu dropdown-menu mt-1" aria-labelledby="d_li">
                            <a class="small dropdown-item" href="{% url 'home:course-detail' course.course_university_slug course.course_instructor_slug course.course_code %}?rw=all&sb=latest">Latest</a>
                            <a class="small dropdown-item" href="{% url 'home:course-detail' course.course_university_slug course.course_instructor_slug course.course_code %}?rw=all&sb=cy">Year</a>
                        </div>
                    </div>
                    {% for prof in reviews  %}
                    <div class="review-group-container">
                        <div class="mb-3 mt-1 text-dark review-prof-title" style="font-size: 1.1rem;font-weight: 600;text-transform: capitalize;">
                            {{ prof.1 }} {{ prof.0 }} - {{reviews|get_dict_item:prof|length}} Reviews
                        </div>                       
                        <div class="review-instructor-all-ctr">
                            {% include 'home/courses/course_reviews.html' with course=course reviews=reviews|get_dict_item:prof all=1 size=reviews|get_dict_item:prof|length %}
                        </div>
                    </div>    
                    {% empty %}
                    <div class="no-review-box">
                        <div class="d-flex justify-content-center pt-2 my-2">
                            <div>
                                <h6>No reviews to show</h6>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <span id="course-all-reviews-shown"></span>
                {% else %}
                    {% include 'home/courses/course_reviews.html' with course=course reviews=reviews all=0 %}
                {% endif %}
            </div>
        </div>
    </div>
</div>
<input id="autocia" type="hidden" value="{{ course.course_instructor }}" />
<input id="autocya" type="hidden" value="{{ course.course_year }}" />
<input id="autocca" type="hidden" value="{{ course.course_code }}" />
<div class="modal fade" id="modal-save-course">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header border-0  p-1">
                <h5 class="modal-title col-12 text-center font-weight-bolder">Save Course</h5>
            </div>
            <div class="moda-body text-center border-0 p-2">
                <span class="mt-2 col-8 text-center text-message text-danger"></span>
            </div>
            <div class="modal-footer border-0 p-1">
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                    style="border-radius: 20px; width: 100%;">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-review-delete">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content"></div>
    </div>
</div>
<style>
    .btn-primary,
    textarea {
        border: rgba(255, 255, 255, 0) !important;
        outline: rgba(255, 255, 255, 0) !important;
        box-shadow: none !important;
        -moz-box-shadow: none !important;
        -webkit-box-shadow: none !important
    }

    label[for=id_review_interest] {
        text-align: right;
        margin-top: .23rem;
        clear: both;
        float: left;
        margin-right: .288rem;
        font-size: .88rem !important;
        margin-left: -1.95rem !important
    }

    #id_review_interest {
        width: 35% !important;
        font-size: .8rem !important
    }
    #id_year {
        display: inline-block !important;
        width: 35% !important;
        font-size: .8rem !important
    }
    .review-span-count {
        font-size:13px;
        font-weight:500;
        color:#487be0;
    }
    a.showMore {
    display:block;
    font-size:13px;
    font-weight:500;
    color:#487be0;
    text-decoration:none;
    }
    a.showMore::after {
        content:'View More';
    }
    a.showMore.showLess::after {
        content:'View Less';
    }
    
</style>
{% endblock content %}